---
title: "STAT 345 Final Project - Drunken Chessmaster"
author: "STAT 345 - Kirk Dahlke"
output: html_document
---

Expected Submission: You will generate a well-written R Markdown report that addresses the following prompts. This R Markdown report should source your analysis code and only display top-level, abstracted code _if/when appropriate_. Choices made during the analysis project should be described and justified in the report. The written report (knitted file) and your analysis code should be submitted to Canvas by Tuesday, May 13 at 6:45pm. 

Advice for getting started:

- Start a conversation chain with your group members. Email is a great place to start, but other options exist (texting, social media platforms, etc.). Set some reasonable expectations for how and when you plan to respond to conversations. It is likely going to be unacceptable to only respond once per week, for example, but also likely unacceptable to expect a response within the hour. Have an honest conversation with your group members about this issue.
- Start the project from a "top-down design" perspective. So, determine what the major steps of the process are, and determine what the inputs and outputs are for each of those steps (the output of step 1 will likely be the input for step 2, for example). This step is much like writing an outline for a paper before you start to write the paper itself, only much more valuable in a group setting. 
- Once you have a sense of the big picture (the outline), determine some "due dates" for each step of the process. Work backwards from the final submission date, giving yourselves time to work on each of the parts as needed. Given the top-down design, you should be able to "divide and conquer" -- working on parts of the project that depend on earlier steps.
- Decide how you plan to share code with each other. Using Git and GitHub is a really good choice here. If not, perhaps some form of shared directory online. In a worst-case scenario, email could also work. 
- Be prepared to give Dr. Baumann (at least) weekly updates on your progress. Some of this can be done via email, but discuss with your group about times you are each available to meet online as well (in an office-hour-like setting). Feel free to request meetings with Dr. Baumann to get help.

**General advice:** Get started early. If you wait to the last minute, it will not go well. For this project, you may find yourself spending a reasonable amount of time _searching_ for help.

1. _Plan Your Trip_ Imagine playing chess with only one piece by always selecting your next move at random from all possible legal moves. This is something a drunken chessmaster might do! Write a function to simulate this process for each of the "Back Row" pieces (rook, knight, bishop, queen, and king), starting at an arbitrary location and allowing for an arbitrary number of moves.

```{r}
install.packages("rchess")
```

```{r}
library(rchess)
library(rvest)
library(stringr)
chss <- Chess$new()
chss$clear()
chss$moves(verbose = TRUE)
#Purpose: To select a random square to put the chosen piece on
#input: string of "q" for a queen, "k" for a king, "p" for a pawn, "n" for a knight, "r" for a rook, "b" for a bishop
#output: A chess board with a randomly placed piece of the users choice
selector_place <- function(piece){
  number <- sample(1:8, 1)
  letter <- sample(letters[1:8], 1)
  spot <- paste(letter, number, sep = "")
  chss$put(piece, "w", spot)
  plot(chss)
}
#Purpose: To make a random move and then change the color of the piece so as to avoid having to have more that one piece on the board.
#Input: None
#Output: Moves the a chess piece randomly and changes the chess pieces color
selector_move <- function(){
  move_num <- sample(1:length(chss$moves()), 1)
  move_choice <- chss$moves()[move_num]
  chss$move(move_choice)
  new_square <- str_match(move_choice, "[abcdefgh][12345678]")
  piece_changer <- chss$get(new_square)
  color_change <- ""
  if(piece_changer$color == "w"){
    color_change <- "b"
  }
  else{
    color_change <- "w"
  }
  chss$put(piece_changer$type, color_change, new_square)
  plot(chss)
}
selector_place("b")
selector_move()
```

2. _Popular Destinations_ Use your functions from part 1 to simulate 1000 moves, starting from several different positions. Create a data visualization of the resulting moves (or alternatively, of the resulting positions).

3. _Vacation Duration_ How many moves does it take for each piece to return where it started? Does it matter where you start? Characterize these distributions.

We tested 5 different starting positions for each piece and simulated 10,000 moves. Using the 10,000 moves we kept track of each time the piece moved back to its original position and recorded how many moves it took for it to occur. We then plotted the distributions for the number of turns it took for each of the five positions. 

```{r Position tracker, message=FALSE, warning=FALSE, include=FALSE}
#Purpose: Create function that clears the board of any pieces and places new piece with new position each time it is called to see if distribution of number of turns changes with different starting positions.
#Input: string of "q" for a queen, "k" for a king, "p" for a pawn, "n" for a knight, "r" for a rook, "b" for a bishop
#Output: Distribution plot of number of times a piece moves back to its original position after a set number of total moves
position_tracker <- function(piece) { 
  chss$clear() 
  chss$moves(verbose = TRUE) 
  selector_place(piece) 
  replicate(10000, selector_move()) # Repeats moves 10000 times
  pieceDf <- chss$history(verbose = TRUE) # Creates data frame to track position of piece
  pieceDf <- subset(pieceDf, to == from[1]) # Only includes turns where piece moved back to starting position
  pieceDf <- pieceDf %>% mutate(Turns = number_move - lag(number_move, default = first(number_move))) # Creates column that shows number of moves it took to return back to original position.
  pieceDf[1,8] = pieceDf[1,7] # Sets first turn piece moved back to origin to the original number of moves since previous code made it equal to 0.
  ggplot(data = pieceDf, aes(x = Turns)) + geom_density() + geom_vline(data = pieceDf, aes(xintercept = mean(Turns)), linetype="dashed", size=1) + theme_classic() + scale_x_continuous(limits = c(0, 200)) # Creates density plot of number of moves it took for the piece to return to its original position.
}
```

###### Bishop Distributions

For the bishop, the average number of turns seems to be around 35 turns. However, there does seem to be a bit of variation with the mean ranging from around 25 to 45. The shape of the distributions do not appear to be very different from each other. Based off of the distribution plots, it appears that starting position may affect the average number of turns for a piece to return to its starting position, however the overall distribution of the number of turns in not affected all that much. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
position_tracker("b")
position_tracker("b")
position_tracker("b")
position_tracker("b")
position_tracker("b")
```

###### Rook Distributions

For the rook, the mean number of turns it took for the piece to return to its original position for each starting postion is around 60 turns, with little variation between the positions. Based off of the distribution plots, it does not appear that starting position affects the mean number of turns it would take for a rook to return to its original position or the shape of the distribution.

```{r echo=FALSE, message=FALSE, warning=FALSE}
position_tracker("r")
position_tracker("r")
position_tracker("r")
position_tracker("r")
position_tracker("r")
```

###### Knight Distributions

For the knight, there is a much wider range of what the mean number of turns it took to return to the pieces original position which in turn also makes the shapes of the distributions different. Based on this, it seems like the starting postion for a knight affects how many turns it would take to its original position. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
position_tracker("n")
position_tracker("n")
position_tracker("n")
position_tracker("n")
position_tracker("n")
```

###### Queen Distributions

For the queen, the mean number of turns appears to stay around 60, however there is a bit of variation both above and below 60. The shape of the distributions do not change much between the positions. Based on this, it does not appear that the starting position for a queen affects how many moves on average it takes to return to that position.

```{r echo=FALSE, message=FALSE, warning=FALSE}
position_tracker("q")
position_tracker("q")
position_tracker("q")
position_tracker("q")
position_tracker("q")
```

###### King Distributions

```{r echo=FALSE, message=FALSE, warning=FALSE}
position_tracker("k")
position_tracker("k")
position_tracker("k")
position_tracker("k")
position_tracker("k")
```

###### Comparing Distributions between Pieces

The only piece that was greatly affected by starting position was the knight. This makes sense as the knight has the least amount of legal moves it can make given that there are no other pieces on the board (8 moves). So if that piece started where it number of legal moves would decrease even more, it makes sense that the number of turns would be affected more than the other pieces. The bishop had the lowest average amount of turns between the remaining four pieces. This also makes sense as it is the next most resricted piece in terms of number of legal moves, being that it can only move in four directions for as many spaces as the board has. The rook and the queen had similar average number of turns although the shapes of their distributions were a little different. This also makes sense as the queen can move like both the rook and the bishop, so it has more possible moves than any other piece which causes an increase in spread which changes the shape of the distribution.


4. _Visit Some Friends_ Consider two drunken chessmasters playing against each other. They both start with a king and a queen, in the traditional starting positions. They each will take turns making moves at random from all possible legal moves. The players are allowed to "attack" the other player's pieces, and the game stops when a player attacks the other player's King. Simulate this process. (Since these chessmasters are presumably drunk, you may ignore the conditions and rules that place a King into "check".)

5. _Share the Pictures_ Where do the games in part 4 typically end?  How long does it take for these games to end? Create data visualizations to summarize these drunken games.




